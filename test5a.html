<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<title>iOS PWA OneSignal æ¸¬è©¦</title>
<script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
</head>
<body>
<h2>ğŸ“¢ OneSignal iOS PWA æ¸¬è©¦</h2>
<button id="sendBtn" disabled>ç™¼é€æ¸¬è©¦é€šçŸ¥</button>
<div id="status">â³ æª¢æŸ¥è¨‚é–±ç‹€æ…‹ä¸­...</div>

<script>
const workerUrl = "https://crowdtest8r.ctakwah.workers.dev/";

// åˆå§‹åŒ– OneSignal
window.OneSignalDeferred = window.OneSignalDeferred || [];
OneSignalDeferred.push(async function(OneSignal) {
await OneSignal.init({
appId: "880241cd-cc45-4820-b5ec-a1236b0e3e98",
safari_web_id: "ğŸ”‘ æ›æˆä½ çš„ Safari Web ID (å¦‚æœ‰)",
notifyButton: { enable: false }
});
});

// ç™¼é€æ¨æ’­
async function sendPush() {
const res = await fetch(workerUrl + "sendPush", {
method: "POST",
headers: { "Content-Type": "application/json" },
body: JSON.stringify({
title: "âš ï¸ é™é›¨æç¤º",
message: "ä½ æ‰€åœ¨çš„ä½ç½®å°‡æœƒæœ‰é›¨",
url: "https://safecrossinghk.github.io"
})
});
const data = await res.json();
alert("é€šçŸ¥å·²é€å‡ºï¼š" + JSON.stringify(data));
}

document.getElementById("sendBtn").addEventListener("click", sendPush);

// å®šæ™‚æª¢æŸ¥æ˜¯å¦å·²è¨‚é–±
setInterval(async () => {
try {
const optedIn = await OneSignal.User.PushSubscription.optedIn;
if (optedIn) {
document.getElementById("status").textContent = "âœ… å·²è¨‚é–±é€šçŸ¥ï¼Œå¯ä»¥ç™¼é€";
document.getElementById("sendBtn").disabled = false;
} else {
document.getElementById("status").textContent = "âš ï¸ å°šæœªå…è¨±é€šçŸ¥ï¼Œè«‹å…è¨±å¾Œå†è©¦";
document.getElementById("sendBtn").disabled = true;
}
} catch (e) {
document.getElementById("status").textContent = "âŒ ç„¡æ³•æª¢æŸ¥é€šçŸ¥ç‹€æ…‹";
}
}, 3000);
</script>
</body>
</html>