<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>é¦™æ¸¯åœ°å€æœªä¾†åŠå°æ™‚é›¨å‹¢</title>
</head>
<body>
<h2>é¦™æ¸¯åœ°å€æœªä¾†åŠå°æ™‚é›¨å‹¢</h2>
<div id="rainText">âŒ› æ­£åœ¨è¼‰å…¥é›¨å‹¢è³‡æ–™...</div>

<script>
const API_KEY = "Eff94C5FCuRqlqWKPt0tXwHM1niZNEYh"; // <<< æ›æˆä½ çš„ Tomorrow.io API Key
const LAT = 22.3, LON = 114.2; // é¦™æ¸¯åº§æ¨™

fetch(`https://api.tomorrow.io/v4/weather/forecast?location=${LAT},${LON}&timesteps=1m&units=metric&apikey=${API_KEY}`)
.then(res => res.json())
.then(data => {
console.log(data); // æ¸¬è©¦ç”¨ï¼Œå…ˆçœ‹çœ‹ API å›å‚³çš„å®Œæ•´ JSON

// âš ï¸ æ³¨æ„ï¼šTomorrow.io v4 JSON çµæ§‹ä¿‚ data.timelines.minutely
const minutes = data.timelines.minutely;
if (!minutes) throw new Error("API æ²’æœ‰è¿”å› minutely è³‡æ–™");

let maxRain = 0;
let maxProb = 0;

// å–åŠå°æ™‚ (30åˆ†é˜) è³‡æ–™
minutes.slice(0, 30).forEach(m => {
if (m.values.rainIntensity > maxRain) maxRain = m.values.rainIntensity;
if (m.values.precipitationProbability > maxProb) maxProb = m.values.precipitationProbability;
});

let text = "æœªä¾†åŠå°æ™‚ï¼š";
if (maxRain === 0) text += "â˜€ï¸ ç„¡é›¨";
else if (maxRain < 2) text += "ğŸŒ¦ å°é›¨";
else if (maxRain < 5) text += "ğŸŒ§ ä¸­é›¨";
else text += "â›ˆ å¤§é›¨";

document.getElementById("rainText").innerText = text + ` (æœ€é«˜é™é›¨æ©Ÿç‡ ${maxProb}%)`;
})
.catch(err => {
console.error(err);
document.getElementById("rainText").innerText = "âš ï¸ é›¨å‹¢è³‡æ–™è®€å–å¤±æ•—";
});
</script>
</body>
</html>
