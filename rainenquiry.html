<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>香港即時雨量測試 (手機版)</title>
<style>
body {
font-family: Arial, sans-serif;
margin: 10px;
padding: 0;
background: #f8f9fa;
}
h2 {
text-align: center;
}
.controls {
display: flex;
flex-direction: column;
gap: 8px;
margin-bottom: 12px;
}
.controls label {
font-size: 1rem;
}
input, button {
font-size: 1rem;
padding: 6px;
}
button {
background: #007bff;
color: white;
border: none;
border-radius: 4px;
}
button:hover {
background: #0056b3;
}
.cards {
display: flex;
flex-wrap: wrap;
gap: 10px;
justify-content: center;
}
.card {
flex: 1 1 150px;
background: white;
border-radius: 8px;
box-shadow: 0 2px 6px rgba(0,0,0,0.1);
padding: 12px;
text-align: center;
}
.card h3 {
margin: 0 0 5px;
font-size: 1.1rem;
}
.card p {
margin: 0;
font-size: 1rem;
}
.table-container {
overflow-x: auto;
margin-top: 15px;
}
table {
border-collapse: collapse;
width: 100%;
font-size: 0.9rem;
}
th, td {
border: 1px solid #ccc;
padding: 6px;
text-align: center;
}
pre {
background: #222;
color: #0f0;
padding: 10px;
border-radius: 6px;
overflow-x: auto;
font-size: 0.85rem;
}
</style>
</head>
<body>
<h2>🌧 香港即時雨量測試</h2>

<div class="controls">
<label>緯度: <input type="text" id="lat" value="22.34"></label>
<label>經度: <input type="text" id="lon" value="114.182"></label>
<label><input type="checkbox" id="debug"> Debug 模式</label>
<button onclick="checkRain()">查詢雨量</button>
</div>

<div class="cards" id="cards"></div>

<div class="table-container">
<table id="rainTable">
<thead>
<tr>
<th>時段</th>
<th>雨量 (mm)</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<h3>Debug JSON 輸出</h3>
<pre id="result">等待查詢...</pre>

<script>
async function checkRain() {
const lat = document.getElementById("lat").value;
const lon = document.getElementById("lon").value;
const debug = document.getElementById("debug").checked;

const url = `https://safecrossinghk.github.io/rainenquiry.html?lat=${lat}&lon=${lon}${debug ? "&debug=true" : ""}`;

try {
const res = await fetch(url);
const data = await res.json();

// 顯示卡片
const cards = document.getElementById("cards");
cards.innerHTML = "";
if (data.debugRaw && data.debugRaw.rainSeries) {
Object.entries(data.debugRaw.rainSeries).forEach(([key, val]) => {
const div = document.createElement("div");
div.className = "card";
div.innerHTML = `<h3>${key}</h3><p>${val !== null ? val + " mm" : "—"}</p>`;
cards.appendChild(div);
});
} else {
cards.innerHTML = `<div class="card"><h3>即時雨量</h3><p>${data.immediateRain} mm</p></div>`;
}

// 表格
const tbody = document.querySelector("#rainTable tbody");
tbody.innerHTML = "";
if (data.debugRaw && data.debugRaw.rainSeries) {
Object.entries(data.debugRaw.rainSeries).forEach(([key, val]) => {
const tr = document.createElement("tr");
tr.innerHTML = `<td>${key}</td><td>${val !== null ? val + " mm" : "—"}</td>`;
tbody.appendChild(tr);
});
} else {
const tr = document.createElement("tr");
tr.innerHTML = `<td>即時</td><td>${data.immediateRain} mm</td>`;
tbody.appendChild(tr);
}

// JSON
document.getElementById("result").textContent = JSON.stringify(data, null, 2);
} catch (err) {
document.getElementById("result").textContent = "❌ 錯誤: " + err.message;
}
}
</script>
</body>
</html>