<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<title>æœªä¾†å…©å°æ™‚é›¨é‡æç¤º</title>
</head>
<body>
<div id="rainMsg"></div>

<script>
const API_KEY = "ä½ çš„API_KEY";
const LAT = 22.3, LON = 114.2; // é¦™æ¸¯åº§æ¨™

fetch(`https://api.tomorrow.io/v4/weather/forecast?location=${LAT},${LON}&timesteps=1m&endTime=+120m&apikey=${API_KEY}`)
.then(res => res.json())
.then(data => {
const minutes = data.timelines.minutely.slice(0, 120); // å–æœªä¾†120åˆ†é˜
const rains = minutes.map(m => m.values.rainIntensity);

// æ¢ä»¶1: æ˜¯å¦æœ‰ >= 2.5 mm/hr
const overThreshold = rains.some(r => r >= 2.5);

// æ¢ä»¶2: æ˜¯å¦æœ‰ä¸Šå‡è¶¨å‹¢ï¼ˆç°¡å–®ï¼šæœ€å¾Œå€¼ > æœ€åˆå€¼ï¼‰
const upwardTrend = rains[rains.length - 1] > rains[0];

// ä½ å¯ä»¥ç”¨æ›´åš´è¬¹å˜…æ–¹æ³•ï¼Œä¾‹å¦‚ã€Œæœ‰ä¸€æ®µé€£çºŒä¸Šå‡ã€ï¼š
let hasRising = false;
for (let i = 1; i < rains.length; i++) {
if (rains[i] > rains[i - 1]) {
hasRising = true;
break;
}
}

let msg = "æš«æ™‚æœªè¦‹éœ€è¦æç¤ºã€‚";
if (overThreshold && (upwardTrend || hasRising)) {
msg = "ğŸŒ§ æœªä¾†å…©å°æ™‚é›¨é‡å°‡é”åˆ° 2.5mm/hr ä»¥ä¸Šï¼Œä¸¦å‡ºç¾ä¸Šå‡è¶¨å‹¢ï¼è«‹ç•™æ„ã€‚";
}

document.getElementById("rainMsg").innerText = msg;
})
.catch(() => document.getElementById("rainMsg").innerText = "âš ï¸ è³‡æ–™è®€å–å¤±æ•—");
</script>
</body>
</html>
