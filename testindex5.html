<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>OneSignal v16 æ¨æ’­æ¸¬è©¦</title>
<script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script>
<style>
body {
font-family: "Microsoft JhengHei", sans-serif;
background: #f7f7f7;
text-align: center;
padding: 30px;
}
#status {
font-weight: bold;
color: #0066cc;
margin-top: 15px;
}
#playerId {
color: #333;
font-size: 14px;
word-break: break-all;
}
button {
margin-top: 20px;
padding: 10px 20px;
font-size: 16px;
cursor: pointer;
}
#error {
color: red;
margin-top: 10px;
}
</style>
</head>
<body>
<h2>ğŸ“¡ OneSignal v16 æ¨æ’­æ¸¬è©¦é é¢</h2>
<div id="status">åˆå§‹åŒ–ä¸­...</div>
<div>Player IDï¼š</div>
<div id="playerId">å°šæœªå–å¾—</div>
<button id="testBtn" disabled>ç™¼é€æ¸¬è©¦æ¨æ’­</button>
<div id="error"></div>

<script>
const appId = "880241cd-cc45-4820-b5ec-a1236b0e3e98"; // ğŸ”¹ è«‹æ›¿æ›æˆä½ çš„ OneSignal App ID
const workerUrl = "https://crowdtest8r.ctakwah.workers.dev"; // ğŸ”¹ è«‹æ›¿æ›æˆä½ çš„ Worker ç¶²å€

window.OneSignal = window.OneSignal || [];
OneSignal.push(function() {
OneSignal.init({ appId: appId });
console.log("âœ… OneSignal å·²åˆå§‹åŒ–");

document.getElementById("status").innerText = "SDK åˆå§‹åŒ–å®Œæˆï¼Œæª¢æŸ¥æˆæ¬Š...";

// æª¢æŸ¥æˆæ¬Šç‹€æ…‹
OneSignal.isPushNotificationsEnabled(function(isEnabled) {
if (isEnabled) {
console.log("ğŸ”” æ¨æ’­å·²å•Ÿç”¨");
document.getElementById("status").innerText = "æ¨æ’­å·²å•Ÿç”¨ï¼Œæ­£åœ¨å–å¾— Player ID...";

OneSignal.getUserId(function(playerId) {
if (playerId) {
console.log("ğŸ¯ Player ID:", playerId);
document.getElementById("playerId").innerText = playerId;
document.getElementById("status").innerText = "âœ… Player ID å·²å–å¾—";
enableTestButton(playerId);
} else {
document.getElementById("status").innerText = "âš ï¸ å°šæœªè¨»å†Š Player IDï¼Œè«‹å˜—è©¦é‡æ–°å…è¨±é€šçŸ¥ã€‚";
}
});
} else {
console.log("ğŸš« å°šæœªæˆæ¬Šæ¨æ’­ï¼Œå˜—è©¦è¨»å†Š...");
OneSignal.registerForPushNotifications();
document.getElementById("status").innerText = "è«‹å…è¨±é€šçŸ¥ä»¥ç¹¼çºŒã€‚";
}
});
});

function enableTestButton(playerId) {
const btn = document.getElementById("testBtn");
btn.disabled = false;
btn.addEventListener("click", async () => {
const title = "æ¸¬è©¦é€šçŸ¥";
const message = "é€™æ˜¯ä¸€å‰‡ OneSignal æ¨æ’­æ¸¬è©¦è¨Šæ¯";

const url = `${workerUrl}?playerId=${playerId}&title=${encodeURIComponent(title)}&message=${encodeURIComponent(message)}`;

document.getElementById("status").innerText = "â³ æ­£åœ¨ç™¼é€æ¨æ’­...";

try {
const res = await fetch(url);
const data = await res.json();
console.log("ğŸ“¬ Worker å›å‚³çµæœ:", data);
document.getElementById("status").innerText = "âœ… æ¨æ’­ç™¼é€æˆåŠŸï¼Œè«‹æŸ¥çœ‹é€šçŸ¥ã€‚";
} catch (err) {
console.error("âŒ æ¨æ’­ç™¼é€å¤±æ•—:", err);
document.getElementById("error").innerText = "âŒ ç™¼é€å¤±æ•—ï¼š" + err.message;
}
});
}
</script>
</body>
</html>