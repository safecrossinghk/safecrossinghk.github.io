<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<title>æœªä¾†2å°æ™‚é›¨å‹¢æç¤º</title>
</head>
<body>
<div id="rainMsg"></div>

<script>
const API_KEY = "Eff94C5FCuRqlqWKPt0tXwHM1niZNEYh"; // Tomorrow.io API Key
const LAT = 22.3, LON = 114.2; // é¦™æ¸¯åº§æ¨™

fetch(`https://api.tomorrow.io/v4/weather/forecast?location=${LAT},${LON}&timesteps=1h&apikey=${API_KEY}`)
.then(res => res.json())
.then(data => {
const hours = data.timelines.hourly.slice(0, 2); // åªå–æœªä¾†2å°æ™‚

let totalRain = 0;
let probs = [];

hours.forEach((h, idx) => {
const rain = h.values.rainIntensity; // æ¯å°æ™‚é›¨é‡ (mm/hr)
const prob = h.values.precipitationProbability; // é™é›¨æ©Ÿç‡ (%)
totalRain += rain;
probs.push(prob);

// Debug log
console.log(`å°æ™‚ ${idx + 1}: é›¨é‡=${rain} mm/hr, æ©Ÿç‡=${prob}%`);
});

const avgRain = totalRain / hours.length; // 2å°æ™‚å¹³å‡é›¨é‡
const maxProb = Math.max(...probs); // å–æœ€é«˜æ©Ÿç‡

console.log(`å¹³å‡é›¨é‡=${avgRain} mm/hr, æœ€é«˜æ©Ÿç‡=${maxProb}%`);

let msg = "";

if (avgRain >= 20) {
msg = "ğŸŒ¦ ä½ æ‰€åœ¨çš„ä½ç½®é è¨ˆç´„å…©å°æ™‚å…§æœ‰é›¨";
} else if (avgRain >= 10) {
msg = "ğŸŒ¦ ä½ æ‰€åœ¨çš„ä½ç½®é è¨ˆç´„å…©å°æ™‚å…§æœ‰é›¨";
} else if (avgRain >= 5 && maxProb >= 70) {
msg = "ğŸŒ¦ ä½ æ‰€åœ¨çš„ä½ç½®é è¨ˆç´„å…©å°æ™‚å…§æœ‰é›¨";
}

if (msg) {
document.getElementById("rainMsg").innerText = msg;
} else {
document.getElementById("rainMsg").innerText = "æä¾›æœªä¾†å…©å°æ™‚å…§é™é›¨è³‡è¨Š";
}
})
.catch(() => document.getElementById("rainMsg").innerText = "ç³»çµ±ç¹å¿™ä¸­ï¼Œè«‹ç¨å€™");
</script>
</body>
</html>