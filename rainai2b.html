<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<title>AI + 天文台 雨量預測</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
font-family: -apple-system, BlinkMacSystemFont, "PingFang HK", "Microsoft JhengHei", sans-serif;
margin: 20px;
padding: 0;
background: #f7f9fc;
color: #222;
}

h2 {
font-size: 1.2rem;
margin: 12px 0;
padding: 10px;
background: #fff;
border-radius: 8px;
box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

#aiProb { color: #0066cc; }
#aiQpf { color: #008800; }
#hkoRain { color: #cc0000; }
#weather { color: #444; }
</style>
</head>
<body>
<h2>AI 預測降雨機率: <span id="aiProb">--%</span></h2>
<h2>AI 預計降雨量: <span id="aiQpf">-- mm</span></h2>
<h2>天文台半小時雨量: <span id="hkoRain">-- mm</span></h2>
<h2>天氣狀況: <span id="weather">--</span></h2>

<script>
async function loadForecast() {
const lat = 22.3027; // 香港中間座標
const lon = 114.1772;

try {
const res = await fetch(`https://rainai2.ctakwah.workers.dev/?lat=${lat}&lon=${lon}`);
const data = await res.json();

console.log("Worker 回傳數據:", data);

// --- AI / Google Weather (MetNet-3) ---
if (data.ai && data.ai.pop_percent !== null) {
document.getElementById("aiProb").textContent = data.ai.pop_percent + "%";
} else {
document.getElementById("aiProb").textContent = "--%";
}

if (data.ai && data.ai.qpf_mm !== null) {
document.getElementById("aiQpf").textContent = data.ai.qpf_mm.toFixed(1) + " mm";

// ⚠️ AI 預測雨量語音提示
if (data.ai.qpf_mm > 5) {
playVoice("⚠️ AI 預測未來一小時可能落雨超過 5 毫米");
}
} else {
document.getElementById("aiQpf").textContent = "-- mm";
}

// --- HKO 半小時雨量 ---
if (data.hko && data.hko.rain_mm !== undefined) {
document.getElementById("hkoRain").textContent = data.hko.rain_mm.toFixed(1) + " mm";

// ⚠️ 天文台雨量語音提示
if (data.hko.rain_mm > 5) {
playVoice("⚠️ 天文台提示：半小時內降雨可能超過 5 毫米");
}
} else {
document.getElementById("hkoRain").textContent = "-- mm";
}

// --- 天氣狀況 ---
if (data.hko && data.hko.condition) {
document.getElementById("weather").textContent = data.hko.condition;
} else {
document.getElementById("weather").textContent = "--";
}

} catch (err) {
console.error("載入失敗:", err);
document.getElementById("aiProb").textContent = "錯誤";
document.getElementById("aiQpf").textContent = "錯誤";
document.getElementById("hkoRain").textContent = "錯誤";
document.getElementById("weather").textContent = "錯誤";
}
}

// 語音播放函數
function playVoice(text) {
if ('speechSynthesis' in window) {
const utter = new SpeechSynthesisUtterance(text);
utter.lang = 'zh-HK'; // 粵語
speechSynthesis.speak(utter);
} else {
console.warn("瀏覽器不支援語音播放");
}
}

loadForecast();
</script>
</body>
</html>