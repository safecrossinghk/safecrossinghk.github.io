<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å³æ™‚é›¨é‡ + é å ± (æ‰‹æ©Ÿç‰ˆ)</title>
<style>
body {
font-family: "PingFang HK", "Microsoft JhengHei", sans-serif;
margin: 0;
padding: 0;
background: #f0f2f5;
color: #333;
}
header {
background: #0078d7;
color: white;
padding: 1rem;
text-align: center;
font-size: 1.2rem;
}
.container {
padding: 1rem;
display: flex;
flex-direction: column;
gap: 1rem;
}
button {
padding: 1rem;
font-size: 1.1rem;
border: none;
border-radius: 8px;
background: #0078d7;
color: white;
cursor: pointer;
}
button:active {
background: #005a9e;
}
.toggle-btn {
background: #6c757d;
}
.toggle-btn.active {
background: #28a745;
}
.card {
background: white;
padding: 1rem;
border-radius: 8px;
box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
.rain {
font-size: 1.1rem;
font-weight: bold;
padding: 0.5rem;
border-radius: 5px;
margin-top: 0.5rem;
}
.no-rain { background: #c8f7c5; color: #2c662d; }
.light-rain { background: #fff3cd; color: #856404; }
.heavy-rain { background: #f8d7da; color: #721c24; }
.future {
display: flex;
justify-content: space-between;
margin-top: 0.5rem;
}
.future div {
flex: 1;
margin: 0 3px;
padding: 0.5rem;
text-align: center;
border-radius: 5px;
font-size: 0.9rem;
}
</style>
</head>
<body>
<header>ğŸŒ§ å³æ™‚é›¨é‡ + æœªä¾†é å ±</header>
<div class="container">
<button onclick="getRainfall()">ğŸ“ æŸ¥è©¢æˆ‘é™„è¿‘é›¨é‡</button>
<button id="voiceToggle" class="toggle-btn active" onclick="toggleVoice()">ğŸ”Š èªéŸ³æç¤ºï¼šé–‹</button>
<div id="result" class="card">è«‹æŒ‰ä¸Šé¢æŒ‰éˆ•é–‹å§‹æŸ¥è©¢</div>
</div>

<script>
let voiceEnabled = true; // é è¨­é–‹å•ŸèªéŸ³

async function getRainfall() {
if (!navigator.geolocation) {
document.getElementById("result").innerText = "âŒ ç€è¦½å™¨ä¸æ”¯æ´å®šä½";
return;
}

navigator.geolocation.getCurrentPosition(async pos => {
const lat = pos.coords.latitude.toFixed(3);
const lon = pos.coords.longitude.toFixed(3);

const url = `https://enquiry.ctakwah.workers.dev?lat=${lat}&lon=${lon}`;

document.getElementById("result").innerHTML = "â³ æ­£åœ¨æŸ¥è©¢é›¨é‡è³‡æ–™...";

try {
const res = await fetch(url);
const data = await res.json();
renderRainResult(data);
} catch (e) {
document.getElementById("result").innerText = "âš ï¸ ç„¡æ³•è®€å–æ•¸æ“š";
}
}, err => {
document.getElementById("result").innerText = "âŒ ç„¡æ³•å–å¾—å®šä½: " + err.message;
});
}

function renderRainResult(data) {
if (data.error) {
document.getElementById("result").innerText = "âš ï¸ éŒ¯èª¤: " + data.error;
return;
}

let rainClass = "no-rain";
let voiceMessage = data.message;
if (data.immediateRain >= 10) {
rainClass = "heavy-rain";
voiceMessage = "âš ï¸ æœªä¾†æœƒæœ‰å¤§é›¨ï¼Œè«‹å°å¿ƒã€‚";
} else if (data.immediateRain >= 2.5) {
rainClass = "light-rain";
voiceMessage = "âš ï¸ æœªä¾†æœ‰é›¨ï¼Œè«‹æº–å‚™é›¨å…·ã€‚";
} else {
voiceMessage = "â˜ï¸ æš«æ™‚æœªè¦‹æ˜é¡¯é™é›¨ã€‚";
}

document.getElementById("result").innerHTML = `
<div><b>ğŸ“ ä½ç½®ï¼š</b> (${data.location.lat}, ${data.location.lon})</div>
<div class="rain ${rainClass}">å³æ™‚é›¨é‡ï¼š${data.immediateRain} mm<br>${data.message}</div>
<div class="future">
<div style="background:#e7f1ff">30 åˆ†é˜<br>${data.futureRains["30-60min"]} mm</div>
<div style="background:#e7f1ff">60 åˆ†é˜<br>${data.futureRains["60-90min"]} mm</div>
<div style="background:#e7f1ff">90 åˆ†é˜<br>${data.futureRains["90-120min"]} mm</div>
</div>
`;

// âœ… èªéŸ³æ’­å ±ï¼ˆå¯é—œé–‰ï¼‰
if (voiceEnabled) {
speak(voiceMessage);
}
}

function speak(text) {
if ('speechSynthesis' in window) {
const utter = new SpeechSynthesisUtterance(text);
utter.lang = "zh-HK"; // ç²µèª
speechSynthesis.cancel(); // é¿å…é‡ç–Š
speechSynthesis.speak(utter);
}
}

function toggleVoice() {
voiceEnabled = !voiceEnabled;
const btn = document.getElementById("voiceToggle");
if (voiceEnabled) {
btn.classList.add("active");
btn.innerText = "ğŸ”Š èªéŸ³æç¤ºï¼šé–‹";
} else {
btn.classList.remove("active");
btn.innerText = "ğŸ”‡ èªéŸ³æç¤ºï¼šé—œ";
}
}
</script>
</body>
</html>