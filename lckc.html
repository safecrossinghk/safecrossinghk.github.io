<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<title>é«˜å¾·é“è·¯å¯¦æ™‚äº¤é€šæ¸¬è©¦</title>
<script src="https://webapi.amap.com/maps?v=2.0&key=c739c1ac829fc2acf00599662cca95f9"></script>
<style>
body { font-family: "Microsoft JhengHei", sans-serif; margin: 20px; }
#map { width: 100%; height: 400px; margin-top: 10px; }
#output { margin-top: 10px; padding: 10px; background: #f6f6f6; border: 1px solid #ccc; }
</style>
</head>
<body>

<h2>ğŸš¦ é«˜å¾·åœ°åœ– - é“è·¯å¯¦æ™‚äº¤é€šæ¸¬è©¦</h2>
<p>è¼¸å…¥é“è·¯åç¨±ï¼ˆä¾‹å¦‚ï¼šè”æè§’é“ï¼‰ï¼š</p>
<input id="roadName" value="è”æè§’é“" size="20">
<button onclick="getTraffic()">æŸ¥è©¢</button>

<div id="output">å°šæœªæŸ¥è©¢</div>
<div id="map"></div>

<script>
let map;

function initMap() {
map = new AMap.Map("map", {
zoom: 14,
center: [114.1607, 22.3378] // è”æè§’é“ä¸­æ®µï¼ˆä¹é¾ï¼‰
});
}

async function getTraffic() {
const key = "c739c1ac829fc2acf00599662cca95f9"; // â† è«‹æ”¹æˆä½ åœ¨é«˜å¾·é–‹ç™¼è€…å¹³å°ç”³è«‹çš„ Web Key
const road = document.getElementById("roadName").value.trim();

const url = `https://restapi.amap.com/v3/traffic/status/road?key=${key}&name=${encodeURIComponent(road)}&extensions=all`;

try {
const res = await fetch(url);
const data = await res.json();
console.log(data);

if (data.status === "1") {
const info = data.trafficinfo;
const eval = info.evaluation || {};
const desc = eval.description || "æœªæä¾›";
const speed = eval.speed || "0";
const status = eval.status || "æœªçŸ¥";

document.getElementById("output").innerHTML = `
<b>é“è·¯åç¨±ï¼š</b>${road}<br>
<b>äº¤é€šç‹€æ…‹ï¼š</b>${status}<br>
<b>å¹³å‡é€Ÿåº¦ï¼š</b>${speed} km/h<br>
<b>èªªæ˜ï¼š</b>${desc}<br>
<b>è³‡æ–™æ›´æ–°æ™‚é–“ï¼š</b>${info.updateTime || "æœªçŸ¥"}
`;

// é¡¯ç¤ºé“è·¯å¤§è‡´ä½ç½®
const polylineData = info.roads?.[0]?.polyline;
if (polylineData) {
const path = polylineData.split(";").map(p => p.split(",").map(Number));
new AMap.Polyline({
map,
path,
strokeColor: "blue",
strokeWeight: 6,
});
map.setFitView();
}
} else {
document.getElementById("output").innerHTML = `âŒ æŸ¥è©¢å¤±æ•—ï¼š${data.info}`;
}
} catch (e) {
console.error(e);
document.getElementById("output").innerHTML = "âš ï¸ è«‹æ±‚å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–é‡‘é‘°";
}
}

initMap();
</script>

</body>
</html>