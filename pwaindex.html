<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸŒ§ï¸ é¦™æ¸¯é™é›¨é å ±</title>
<meta name="theme-color" content="#f0f8ff" />
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link rel="manifest" href="manifest.json" />
<link rel="apple-touch-icon" href="icon-192.png" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-title" content="é¦™æ¸¯é™é›¨é å ±" />

<style>
body {
font-family: "Helvetica Neue", sans-serif;
margin: 0; padding: 0;
background: #f0f8ff; color: #333; text-align: center;
}
h1 { font-size: 1.4em; margin: 1em 0; }
#map { height: 300px; margin: 10px; border-radius: 8px; border: 1px solid #ccc; }
#rain-alert { margin: 1em; font-size: 1.1em; font-weight: bold; }
.promptBox {
position: fixed; bottom: 20px; left: 10%; right: 10%;
background: #fff3cd; border: 1px solid #ffeeba; border-radius: 8px;
padding: 12px; z-index: 9999; box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}
.promptBox button {
margin-top: 8px; padding: 6px 12px;
background: #0077cc; color: white; border: none; border-radius: 5px;
}
</style>

<script>
if ("serviceWorker" in navigator) {
navigator.serviceWorker.register("service-worker.js")
.then(() => console.log("âœ… Service Worker è¨»å†ŠæˆåŠŸ"))
.catch(e => console.error("âŒ Service Worker è¨»å†Šå¤±æ•—", e));
}
</script>

<!-- âœ… OneSignal SDK -->
<script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" async></script>

<script>
window.OneSignalDeferred = window.OneSignalDeferred || [];
OneSignalDeferred.push(async function(OneSignal) {
await OneSignal.init({
appId: "880241cd-cc45-4820-b5ec-a1236b0e3e98", // â† æ”¹æˆä½ çš„ App ID
safari_web_id: "web.onesignal.auto.<ä½ çš„_safari_web_id>", // âš ï¸ æ”¹æˆä½ çš„ Safari Web ID
notifyButton: { enable: true },
allowLocalhostAsSecureOrigin: true
});
console.log("âœ… OneSignal å·²åˆå§‹åŒ–");

// æª¢æŸ¥ Player ID
try {
const pid = await OneSignal.User.PushSubscription.id;
if (pid) {
console.log("ğŸ¯ Player ID:", pid);
localStorage.setItem("playerId", pid);
}
} catch (e) {
console.warn("âš ï¸ æœªå–å¾— Player ID", e);
}

// é¡¯ç¤ºè¨‚é–±æç¤º
OneSignal.Slidedown.promptPush();
});
</script>
</head>

<body>
<h1>ğŸŒ‚ é¦™æ¸¯é™é›¨é å ±ï¼ˆiOS æ¨æ’­æ¸¬è©¦ç‰ˆï¼‰</h1>
<div id="map"></div>
<div id="rain-alert">â³ è¼‰å…¥ä¸­...</div>

<div id="iosPrompt" class="promptBox" style="display:none;">
ğŸ“± iPhone ç”¨æˆ¶ï¼šè«‹å…ˆæŒ‰ Safari åº•éƒ¨çš„ã€Œåˆ†äº«ã€â†’ã€ŒåŠ å…¥ä¸»ç•«é¢ã€<br>
âœ… ç„¶å¾Œå¾ä¸»ç•«é¢é–‹å•Ÿï¼Œå…è¨±é€šçŸ¥å¾Œå³å¯æ”¶åˆ°æ¨æ’­ã€‚<br>
<button id="iosCloseBtn">çŸ¥é“äº†</button>
</div>

<script>
const ua = navigator.userAgent;
if (/iPhone|iPad/i.test(ua)) {
document.getElementById("iosPrompt").style.display = "block";
document.getElementById("iosCloseBtn").onclick = () => {
document.getElementById("iosPrompt").style.display = "none";
};
}
</script>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</body>
</html>